# sources:
#   - name: CoffinBox
#     handler:
#       graphql:
#         endpoint: https://{context.host:api.thegraph.com}/subgraphs/name/{context.name:matthewlilley/coffinbox-ethereum}
#     transforms:
#       - addSourceName: true
#       - prefix:
#           value: coffinbox_
#           includeRootOperations: true
#           includeTypes: false
#       - autoPagination:
#           validateSchema: true

sources:
  - name: CoffinBox
    handler:
      graphql:
        # Default value is coffinbox-polygon
        # This is needed for the initial introspection on buildtime
        endpoint: https://{context.host:api.thegraph.com/subgraphs/name}/{context.name:sushiswap/coffinbox-polygon}
  - name: TheGraph
    handler:
      graphql:
        endpoint: https://api.thegraph.com/index-node/graphql

additionalTypeDefs: |
  extend type CoffinBoxKpi {
    chainId: BigInt
  }
  extend type StrategyKpi {
    chainId: BigInt
  }
  extend type Query {
    crossChainCoffinBoxKpis(first: Int!, chainIds: [BigInt!]!): [CoffinBoxKpi!]!
    crossChainStrategyKpis(first: Int!, chainIds: [BigInt!]!): [StrategyKpi!]!
  }

  enum SubgraphType {
    Current
    Pending
  }
  enum SubgraphStatus {
    Synced
    Syncing
    Failed
  }
  type Subgraph {
    subgraphName: String
    subgraphId: String
    type: SubgraphType
    status: SubgraphStatus
    startBlock: BigInt
    lastSyncedBlock: BigInt
    chainHeadBlock: BigInt
    hasFailed: Boolean
    nonFatalErrorCount: BigInt
    entityCount: BigInt
  }
  extend type Query {
    subgraphs(subgraphNames: [String!]!, type: SubgraphType!): [Subgraph!]!
  }

additionalResolvers:
  - ./resolvers.ts

documents:
  - ./query.graphql

codegen:
  contextType: 'MeshContext & { chainId: string; name: string; host: string }'